var NiceWeather=NiceWeather||{};NiceWeather.jsonp=function(){var e={};return e.send=function(e,t){var a=t.callbackName||"callback",r=t.onSuccess||function(){},n=t.onTimeout||function(){},o=t.timeout||10,i=window.setTimeout(function(){window[a]=function(){},n()},1e3*o);window[a]=function(e){window.clearTimeout(i),r(e)};var c=document.createElement("script");c.type="text/javascript",c.async=!0,c.src=e,document.getElementsByTagName("head")[0].appendChild(c)},e}();var NiceWeather=NiceWeather||{};NiceWeather.dataBind=function(){"use strict";var e={};return e.update=function(e,t){t||(t=document);var a,r=t.querySelectorAll("[data-bind]");for(a=0;a<r.length;a++){var n,o,i=r[a],c=i.dataset.bind,u=c.split("."),l=JSON.parse(JSON.stringify(e)),s=u.length-1;for(n in u)u.hasOwnProperty(n)&&(o=u[n],"undefined"!=typeof l[o]&&(n==s?i.innerHTML=l[o]:l=l[o]))}return NiceWeather.dataBind},e}();var NiceWeather=NiceWeather||{};NiceWeather.storage=function(){"use strict";var e={};return e.unset=function(e){localStorage.removeItem(e)},e.get=function(e){if(!localStorage[e])return null;var t=JSON.parse(localStorage[e]);return null===t.timestamp||(new Date).getTime()<t.timestamp?t.value:null},e.set=function(e,t,a){var r;r=a?{value:t,timestamp:(new Date).getTime()+1e3*a}:{value:t,timestamp:null},localStorage[e]=JSON.stringify(r)},e}();var NiceWeather=NiceWeather||{};NiceWeather.model=function(e){"use strict";var t,a={};return a.load=function(e){var r=a.getFromCache();r?(console.log("from cache"),t=r,e()):(console.log("we have to get from outside"),a.getFromServer(e))},a.getFromServer=function(a){var r="modelCallback"+Math.round(1e3*Math.random());NiceWeather.jsonp.send("http://weather.spychalski.info/api.php?callback="+r,{callbackName:r,onSuccess:function(r){e.set("weatherData",r,1800),t=r,a(r)}})},a.getFromCache=function(){return e.get("weatherData")},a.getNow=function(){return{icon:"./img/icons/icon_"+t.WeatherIcon+".png",temperature:{now:Math.round(parseFloat(t.Temperature)),day:null,night:null,max:null,min:null},pressure:Math.round(parseFloat(t.Pressure)),humidity:Math.round(parseFloat(t.Humidity)),wind:{speed:Math.round(parseFloat(t.WindSpeed)),direction:Math.round(parseFloat(t.WindDirection))}}},a.getForecast=function(e){var a=t.Forecast[e];return{icon:"./img/icons/icon_"+a.WeatherIcon+".png",temperature:{now:null,day:Math.round(parseFloat(a.TempDay)),night:Math.round(parseFloat(a.TempNight)),max:Math.round(parseFloat(a.TempMax)),min:Math.round(parseFloat(a.TempMin))},pressure:Math.round(parseFloat(a.Pressure)),humidity:Math.round(parseFloat(a.Humidity)),wind:{speed:Math.round(parseFloat(a.WindSpeed)),direction:Math.round(parseFloat(a.WindDirection))}}},a}(NiceWeather.storage);var NiceWeather=NiceWeather||{};NiceWeather.controller=function(e){"use strict";var t={};return t.init=function(){NiceWeather.model.load(t.onDataLoaded)},t.onDataLoaded=function(){var t,a,r;for(t=-1;2>t;t++)-1===t?(r=NiceWeather.model.getNow(),a=e.querySelector("#weather-now")):(r=NiceWeather.model.getForecast(t),a=e.querySelector("#weather-"+t)),a.getElementsByClassName("readout__icon")[0].src=r.icon,NiceWeather.dataBind.update(r,a)},t}(document.getElementsByClassName("readouts")[0]),NiceWeather.controller.init();